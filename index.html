<!doctype html>
<html>
<head>

  <title>Transaction Mapper</title>
  
  <!-- jQuery -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

  <!-- html2canvas -->
  <script type="text/javascript" src="html2canvas.js"></script>
  <script type="text/javascript" src="canvas2image.js"></script>

  <!-- Vis DOT mapper -->
  <script type="text/javascript" src="vis.js"></script>
  <link href="vis.css" rel="stylesheet" type="text/css" />
  
  <!-- jQuery Print Element -->
  <script type="text/javascript" src="jquery.printElement.js"></script>
  <script type="text/javascript" src="jquery.browser.js"></script>
  <script type="text/javascript" src="base64.js"></script>
  
  <!-- My CSS -->
  <link href="my.css" rel="stylesheet" type="text/css" />

  <script>

    // Global variables
    var gNetwork;
    var gData;

    // Resize the map when window resizes
    window.onresize = function () {
      gNetwork.redraw()
    };

    // Draw the map
    function draw () {
      try {

        // TEST DATA FOR NOW!
        gData = {
          dot: "digraph {\
            node [shape=circle fontSize=16]\
            edge [length=100, color=gray, fontColor=black]\
            A -> B;\
            B -> C;\
            C -> A;\
          }"
        };

        // create a network
        var container = $("#map")[0];
        var options = {};
        gNetwork = new vis.Network(container, gData, options);
        gNetwork.redraw();
      }
      catch (err) {
        console.log(err.toString());
      }
    }

    $(function() {

      $("#download_button").click(function() {
        html2canvas($("#map_area"), {
          onrendered: function(canvas) {
            Canvas2Image.saveAsPNG(canvas); 
          }
        });
      });

      $("#print_button").click(function() {
       
//          var dataURI = $("#map")[0].toDataURL();
        var image = Canvas2Image.saveAsPNG($("#map")[0], true);
        $("#map").html(image);
        delete gNetwork;
        $("#map_area").printElement();

          
          // Focus event used to catch print window closing - puts things back as they were
          // TBD
       
      });

      // Initial drawing
      draw();

    });

  </script>

</head>

<body>

  <h2>Transaction Mapper</h2>
  All changes saved automatically (no access controls, no versioning). <a href="">This is a video on how it works</a>. 
  Please send questions to <a href="mailto:david.durant@digital.cabinet-office.gov.uk">David Durant</a>.<br/>
  Thanks to the folks behind <a href="http://visjs.org/">vis.js</a>, <a href="http://html2canvas.hertzen.com/">html2canvas</a>, <a href="http://www.nihilogic.dk/labs/canvas2image/">canvase2image</a> and <a href="http://projects.erikzaadi.com/jQueryPlugins/jQuery.printElement/">jQuery Print Element</a><p/>
  <b>Add some undeletable examples</b>?
  
  <hr/>

  Transaction CRUD / Steps CRUD / Actions CRUD / Journey CURD / Actions to show<br/>
  For each - multi-select-type widget set to single-select, top item is always 'new', under is a text box and too buttons (add/update and delete), click on row puts text in box / updates rest of boxes / changes button to update, click on new resets, add button adds, delete removes selected

  <hr/>
  <button id="download_button">Click to download map as PNG</button> | <button id="print_button" style="background-color:#dd3333;">Click to print map</button> | <button id="toggle_button" style="background-color:#dd3333;">Click to toggle step references</button>
  <hr/>

  <div id="map_area">
    <h3>Transaction: <span id="transaction_name">None selected</span> | 
    User journey: <span id="journey_name">None selected</span></h3>
    <hr/>

    <div id="map"></div>

  </div>
 
</body>
</html>
