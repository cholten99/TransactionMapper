<!doctype html>
<html>
<head>

  <title>Transaction Mapper</title>
  
  <!-- jQuery -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

  <!-- html2canvas -->
  <script type="text/javascript" src="js/html2canvas.js"></script>
  <script type="text/javascript" src="js/canvas2image.js"></script>

  <!-- Vis DOT mapper -->
  <script type="text/javascript" src="js/vis.js"></script>
  <link href="css/vis.css" rel="stylesheet" type="text/css" />
  
  <!-- jQuery Print Element -->
  <script type="text/javascript" src="js/jquery.printElement.js"></script>
  <script type="text/javascript" src="js/jquery.browser.js"></script>
  <script type="text/javascript" src="js/base64.js"></script>
  
  <!-- My CSS -->
  <link href="css/my.css" rel="stylesheet" type="text/css" />

  <script>

    // Global variables
    var gNetwork;
    var gData;
    var gPrinting = false;
    var gShowControls = true;

    // Resize the map when window resizes
    window.onresize = function () {
      gNetwork.redraw()
    };

    // Draw the map
    function draw () {
      try {

        // TEST DATA FOR NOW!
        gData = {
          dot: "digraph {\
            node [shape=circle fontSize=16]\
            edge [length=100, color=gray, fontColor=black]\
            A -> B;\
            B -> C;\
            C -> A;\
          }"
        };

        // create a network
        var container = $("#map")[0];
        var options = { height: '400px' };
        gNetwork = new vis.Network(container, gData, options);
        gNetwork.redraw();
      }
      catch (err) {
        console.log(err.toString());
      }
    }

    $(function() {

      $("#toggle_controls_button").click(function() {
        if (gShowControls == true) {
          gShowControls = false;
          $("#crud_wrapper").hide();
        } else {
          gShowControls = true;
          $("#crud_wrapper").show();
        }
      });

      $("#download_button").click(function() {
        html2canvas($("#map_area"), {
          onrendered: function(canvas) {
            Canvas2Image.saveAsPNG(canvas); 
          }
        });
      });

      $("#print_button").click(function() {
        html2canvas($("#map_area"), {
          onrendered: function(canvas) {
            gPrinting = true;
            var image = Canvas2Image.saveAsPNG(canvas, true); 
            $("#print_area").html(image);
            $("#print_area").printElement();
          }
        });
      
      });

      // Focus event used to catch print window closing - puts things back as they were before printing
      $(window).focus(function() {
        if (gPrinting) {
          $("#print_area").html("");
          gPrinting = false;
        }
      });

      // Initial drawing
      draw();

    });

  </script>

</head>

<body>

  <h2>Transaction Mapper</h2>
  All changes saved automatically (no access controls, no versioning). <a href="">This is a video on how it works</a>. 
  Please send questions to <a href="mailto:david.durant@digital.cabinet-office.gov.uk">David Durant</a>.<br/>
  
  <hr/>

  | <button id="toggle_controls_button">Click to toggle controls</button> | <button id="download_button">Click to download map as PNG</button> | <button id="print_button">Click to print map</button> | <button id="toggle_button" style="background-color:#dd3333;">Click to toggle step references</button> |
  <hr/>

  <div id="crud_wrapper">

  <div id="transaction_area">
    <b>Transactions</b>
    <select name="transaction_select" size="8" style="width:95%;" multiple>
      <option value="new">-> New <-</option>
      <option value="saab">Saab</option>
      <option value="opel">Opel</option>
    </select><p/>
    <input id="transaction_input" style="width:55%;"></input>
    <button id="transaction_button">Add</button>
    <button id="transaction_delete_button">Delete</button>
  </div>
  
  <div id="steps_area">
    <b>Steps for transaction</b>
    <select name="steps_select" size="8" style="width:95%;" multiple>
      <option value="new">-> New <-</option>
      <option value="saab">Saab</option>
      <option value="opel">Opel</option>
    </select><p/>
    <input id="steps_input" style="width:55%;"></input>
    <button id="steps_button">Add</button>
    <button id="steps_delete_button">Delete</button>
  </div>
  
  <div id="actions_area">
    <b>Actions for transaction</b>
    <select name="actions_select" size="5" style="width:95%;" multiple>
      <option value="new">-> New <-</option>
      <option value="saab">Saab</option>
      <option value="opel">Opel</option>
    </select><p/>
    <select name="actions_thing_one_select" style="width:45%;">
      <option value="new">Stuff</option>
      <option value="saab">Saab</option>
      <option value="opel">Opel</option>
    </select>
    &nbsp;
    <select name="actions_thing_two_select" style="width:45%;">
      <option value="new">Stuff</option>
      <option value="saab">Saab</option>
      <option value="opel">Opel</option>
    </select><p/>
    <input id="actions_input" style="width:55%;"></input>
    <button id="actions_button">Add</button>
    <button id="actions_delete_button">Delete</button>
  </div>
  
  <div id="journey_area">
    <b>Journeys for transaction</b>
    <select name="journey_select" size="8" style="width:95%;" multiple>
      <option value="new">-> New <-</option>
      <option value="saab">Saab</option>
      <option value="opel">Opel</option>
    </select><p/>
    <input id="journey_input" style="width:55%;"></input>
    <button id="journey_button">Add</button>
    <button id="jounrey_delete_button">Delete</button>
  </div>
  
  <div id="actions_selected_area">
    <b>Actions to show</b>
    <select name="actions_show_select" size="8" style="width:95%;" multiple>
      <option value="new">-> New <-</option>
      <option value="saab">Saab</option>
      <option value="opel">Opel</option>
    </select><p/>
  </div>
  </div>

  <hr/>

  <div id="map_area">
    <h3>Transaction: <span id="transaction_name">None selected</span> | 
    User journey: <span id="journey_name">None selected</span></h3>
    <hr/>

    <div id="map"></div>

    <!-- Hidden element for printing PNG -->
    <div id="print_area"></div>

  </div>
  
  <hr/>
    Thanks to the folks behind <a href="http://visjs.org/">vis.js</a>, <a href="http://html2canvas.hertzen.com/">html2canvas</a>, <a href="http://www.nihilogic.dk/labs/canvas2image/">canvase2image</a> and <a href="http://projects.erikzaadi.com/jQueryPlugins/jQuery.printElement/">jQuery Print Element</a><p/>
 
</body>
</html>
